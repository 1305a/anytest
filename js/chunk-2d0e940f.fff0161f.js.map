{"version":3,"sources":["webpack:///./src/sequences/SequenceChunkWrapper.js"],"names":["executeExternalAction","externalAction","isFunction","name","functional","props","sequenceId","type","String","required","stepId","chunkId","default","SequenceStepChunkDefinition","DEFAULT_ID","anchorChildIndex","Number","render","createElement","ctx","_anchorChild$data","_ctx$parent$$store$ge","_ctx$parent$$store$ge2","_ctx$parent$$store$ge3","_sequenceDefinition$s","_stepDefinition$chunk","throwError","message","console","error","superMegaCoolErrorStyle","Error","isActive","computed","parent","$store","getters","includes","allChildren","scopedSlots","processChunkAction","async","nestedWrapper","mustReturnTrue","enabledIfEducationIsInactive","store","value","dispatch","result","parseInt","anchorChild","tag","anchorDataAttr","generateUUID","anchorSelector","data","attrs","definition","id","some","sequenceDefinition","sequencesObj","stepDefinition","stepById","chunkDefinition","chunkById","components","map","componentImportStatement"],"mappings":"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","file":"js/chunk-2d0e940f.fff0161f.js","sourcesContent":["import { SequenceStepChunkDefinition } from '@/sequences/SequenceStepChunk/base_classes'\nimport { generateUUID, superMegaCoolErrorStyle } from '@/utils/misc'\nimport { computed } from '@vue/composition-api'\nimport { sequencesObj } from '@/store/modules/sequences'\nimport { isFunction } from 'lodash'\n\nimport {store} from '@/store'\n\nconst executeExternalAction = externalAction => {\n    if (isFunction(externalAction))\n        return externalAction()\n    return externalAction\n}\n\n\nexport default {\n    name: 'SequenceChunkWrapper',\n    functional: true,\n    props: {\n        sequenceId: {\n            type: String,\n            required: true\n        },\n        stepId: {\n            type: String,\n            required: true\n        },\n        chunkId: {\n            type: String,\n            default: SequenceStepChunkDefinition.DEFAULT_ID\n        },\n        anchorChildIndex: {\n            type: [Number, String],\n            default: 0\n        }\n    },\n    render(createElement, ctx) {\n        const throwError = message => {\n            console.error(`%c${message}`, superMegaCoolErrorStyle)\n            throw new Error(`\\n\\nsequenceId: ${ctx.props.sequenceId}\\nstepId: ${ctx.props.stepId}\\nchunkId: ${ctx.props.chunkId}\\n\\n${message}\\n\\n`)\n        }\n\n        const isActive = computed(\n            () => ctx.props.sequenceId === ctx.parent.$store.getters['sequences_store/getActiveSequenceId']\n                && ctx.props.stepId === ctx.parent.$store.getters['sequences_store/getActiveStepId']\n                && ctx.parent.$store.getters['sequences_store/getActiveChunksIds'].includes(ctx.props.chunkId)\n        )\n\n        const allChildren = ctx.scopedSlots.default({\n            processChunkAction: async (externalAction, {\n                nestedWrapper = false,\n                mustReturnTrue = false,\n                enabledIfEducationIsInactive = false,\n            } = {}) => {\n                if (store.getters['mainScreen/getEducationIsChosen']) {\n                    if (isActive.value) {\n                        await ctx.parent.$store.dispatch('sequences_store/takeSnapshot', {...ctx.props})\n                        const result = executeExternalAction(externalAction)\n\n                        if ((mustReturnTrue && result) || !mustReturnTrue)\n                            ctx.parent.$store.dispatch('sequences_store/processChunkAction', {...ctx.props})\n\n                        return result\n                    } else if (nestedWrapper) {\n                        return executeExternalAction(externalAction)\n                    }\n                }\n                else if (enabledIfEducationIsInactive) {\n                    executeExternalAction(externalAction);\n                }\n\n            },\n            isActive: isActive.value\n        })\n\n        const anchorChildIndex = parseInt(ctx.props.anchorChildIndex)\n\n        if (!(anchorChildIndex in allChildren))\n            throwError('Can\\'t find child with provided anchor-child-index')\n\n        let anchorChild = allChildren[anchorChildIndex]\n\n        if (!anchorChild?.tag)\n            throwError('Anchor child must have tag')\n\n        const anchorDataAttr = `data-sequence-chunk-${generateUUID()}`\n        const anchorSelector = `[${anchorDataAttr}]`\n\n        anchorChild.data = {\n            ...(anchorChild?.data || {}),\n            attrs: {\n                ...(anchorChild?.data?.attrs || {}),\n                [anchorDataAttr]: '',\n                ...((ctx.props.stepId === ctx.parent.$store.getters['sequences_store/getActiveStep']?.definition?.id && ctx.parent.$store.getters['sequences_store/getActiveChunks']?.some(({definition: {id}}) => id === ctx.props.chunkId)) && ({\n                    'data-enable-pointer-events': true\n                }))\n            },\n\n        }\n\n        const sequenceDefinition = sequencesObj?.[ctx.props.sequenceId]\n        if (!sequenceDefinition) throwError('Unknown sequence')\n\n        const stepDefinition = sequenceDefinition?.stepById?.[ctx.props.stepId]\n        if (!stepDefinition) throwError('Unknown step')\n\n        const chunkDefinition = stepDefinition?.chunkById?.[ctx.props.chunkId]\n        if (!chunkDefinition) throwError('Unknown chunk')\n\n        return [\n            ...allChildren,\n            ...chunkDefinition.components\n                .map(componentImportStatement => createElement(componentImportStatement, {\n                    props: {\n                        anchorSelector,\n                        ...ctx.props,\n                        chunkDefinition\n                    }\n                }))\n        ]\n    }\n}"],"sourceRoot":""}